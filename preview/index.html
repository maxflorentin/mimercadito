<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>miMercadito â€” Preview</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN SYSTEM â€” miMercadito theme
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --color-bg: #f2f2f7;
      --color-surface: rgba(255, 255, 255, 0.75);
      --color-surface-solid: #ffffff;
      --color-border: rgba(0, 0, 0, 0.08);
      --color-border-focus: rgba(0, 122, 255, 0.40);
      --color-text-primary: #1c1c1e;
      --color-text-secondary: #6e6e73;
      --color-text-tertiary: #aeaeb2;
      --color-accent: #007aff;
      --color-accent-hover: #0062cc;
      --color-accent-muted: rgba(0, 122, 255, 0.08);
      --color-accent-pill: rgba(0, 122, 255, 0.12);
      --color-success: #34c759;
      --color-warning: #ff9500;
      --color-danger: #ff3b30;
      --color-danger-muted: rgba(255, 59, 48, 0.08);
      --color-wa: #25d366;
      --sp-1: 4px;
      --sp-2: 8px;
      --sp-3: 12px;
      --sp-4: 16px;
      --sp-5: 20px;
      --sp-6: 24px;
      --sp-8: 32px;
      --r-sm: 8px;
      --r-md: 12px;
      --r-lg: 16px;
      --r-xl: 20px;
      --r-pill: 999px;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08), 0 1px 4px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.14), 0 2px 8px rgba(0, 0, 0, 0.06);
      --font: 'Inter', system-ui, -apple-system, sans-serif;
      --text-xs: 0.72rem;
      --text-sm: 0.83rem;
      --text-base: 0.95rem;
      --text-md: 1.05rem;
      --text-xl: 1.5rem;
      --text-2xl: 1.9rem;
      --ease: cubic-bezier(0.4, 0, 0.2, 1);
      --duration: 180ms;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: var(--font);
      background: var(--color-bg);
      color: var(--color-text-primary);
      font-size: var(--text-base);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* â”€â”€ Card â”€â”€ */
    .card {
      background: var(--color-surface-solid);
      border: 1px solid var(--color-border);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow-sm);
      padding: var(--sp-6);
    }

    /* â”€â”€ Typography â”€â”€ */
    .text-title {
      font-size: var(--text-xl);
      font-weight: 600;
      letter-spacing: -.02em;
    }

    .text-subtitle {
      font-size: var(--text-md);
      font-weight: 500;
    }

    .text-secondary {
      color: var(--color-text-secondary);
    }

    .text-tertiary {
      color: var(--color-text-tertiary);
    }

    .text-accent {
      color: var(--color-accent);
    }

    .text-success {
      color: var(--color-success);
    }

    .text-danger {
      color: var(--color-danger);
    }

    .text-warning {
      color: var(--color-warning);
    }

    /* â”€â”€ Buttons â”€â”€ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--sp-2);
      padding: 9px 18px;
      border-radius: var(--r-md);
      font-family: var(--font);
      font-size: var(--text-sm);
      font-weight: 500;
      cursor: pointer;
      border: none;
      outline: none;
      transition: all var(--duration) var(--ease);
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--color-accent);
      color: #fff;
      box-shadow: 0 2px 8px rgba(0, 122, 255, .25);
    }

    .btn-primary:hover {
      background: var(--color-accent-hover);
      box-shadow: 0 4px 16px rgba(0, 122, 255, .35);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-ghost {
      background: transparent;
      color: var(--color-accent);
      border: 1px solid var(--color-border);
    }

    .btn-ghost:hover {
      background: var(--color-accent-muted);
      border-color: transparent;
    }

    .btn-danger {
      background: var(--color-danger);
      color: #fff;
    }

    .btn-danger:hover {
      background: #d92e24;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: rgba(0, 0, 0, 0.05);
      color: var(--color-text-secondary);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: rgba(0, 0, 0, 0.08);
    }

    .btn[disabled] {
      opacity: .45;
      cursor: not-allowed;
      pointer-events: none;
    }

    .w-full {
      width: 100%;
    }

    /* â”€â”€ Row action icon buttons â”€â”€ */
    .action-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border: none;
      border-radius: var(--r-sm);
      background: transparent;
      cursor: pointer;
      color: var(--color-text-tertiary);
      transition: all var(--duration) var(--ease);
      padding: 0;
    }

    .action-btn:hover {
      background: rgba(0, 0, 0, 0.06);
      color: var(--color-text-secondary);
    }

    .action-btn.sell:hover {
      background: rgba(52, 199, 89, .12);
      color: var(--color-success);
    }

    .action-btn.wa:hover {
      background: rgba(37, 211, 102, .12);
      color: var(--color-wa);
    }

    .action-btn.delete:hover {
      background: var(--color-danger-muted);
      color: var(--color-danger);
    }

    .action-btn svg {
      pointer-events: none;
    }

    .row-actions {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    /* â”€â”€ Badge â”€â”€ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: var(--r-pill);
      font-size: var(--text-xs);
      font-weight: 500;
    }

    .badge-neutral {
      background: rgba(0, 0, 0, .05);
      color: var(--color-text-secondary);
    }

    .badge-success {
      background: rgba(52, 199, 89, .12);
      color: var(--color-success);
    }

    .badge-warning {
      background: rgba(255, 149, 0, .12);
      color: var(--color-warning);
    }

    .badge-danger {
      background: rgba(255, 59, 48, .12);
      color: var(--color-danger);
    }

    /* â”€â”€ Form Controls â”€â”€ */
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-label {
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .form-control,
    .form-select {
      width: 100%;
      padding: 10px 14px;
      font-family: var(--font);
      font-size: var(--text-base);
      color: var(--color-text-primary);
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--r-md);
      outline: none;
      transition: border-color var(--duration) var(--ease), box-shadow var(--duration) var(--ease);
      appearance: none;
    }

    .form-control::placeholder {
      color: var(--color-text-tertiary);
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px var(--color-border-focus);
      background: #fff;
    }

    /* â”€â”€ Table â”€â”€ */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: var(--text-sm);
    }

    .data-table thead th {
      background: var(--color-bg);
      padding: 11px 16px;
      text-align: left;
      font-size: var(--text-xs);
      font-weight: 600;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: .07em;
      border-bottom: 1px solid var(--color-border);
    }

    .data-table tbody tr {
      border-bottom: 1px solid var(--color-border);
      transition: background var(--duration) var(--ease);
    }

    .data-table tbody tr:last-child {
      border-bottom: none;
    }

    .data-table tbody tr:hover {
      background: var(--color-accent-muted);
    }

    .data-table tbody tr.row-faded {
      opacity: .55;
    }

    .data-table td {
      padding: 12px 16px;
      vertical-align: middle;
    }

    .td-name {
      font-weight: 500;
    }

    .td-mono {
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum";
    }

    /* â”€â”€ Stat cards â”€â”€ */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--sp-4);
    }

    .stat-card {
      background: var(--color-surface-solid);
      border: 1px solid var(--color-border);
      border-radius: var(--r-lg);
      padding: var(--sp-5);
    }

    .stat-value {
      font-size: var(--text-2xl);
      font-weight: 600;
      letter-spacing: -.03em;
      margin-top: var(--sp-1);
      font-variant-numeric: tabular-nums;
    }

    .stat-label {
      font-size: var(--text-xs);
      font-weight: 500;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: .07em;
    }

    /* â”€â”€ Layout â”€â”€ */
    .flex {
      display: flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .gap-3 {
      gap: var(--sp-3);
    }

    .gap-4 {
      gap: var(--sp-4);
    }

    .gap-6 {
      gap: var(--sp-6);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--sp-4);
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: var(--sp-4);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: var(--sp-6);
    }

    .page-narrow {
      max-width: 540px;
      margin: 0 auto;
      padding: var(--sp-6);
    }

    /* â”€â”€ Status msg â”€â”€ */
    .status-msg {
      font-size: var(--text-sm);
      text-align: center;
      padding: var(--sp-3);
      border-radius: var(--r-md);
    }

    .status-msg.success {
      background: rgba(52, 199, 89, .10);
      color: var(--color-success);
    }

    .status-msg.error {
      background: rgba(255, 59, 48, .10);
      color: var(--color-danger);
    }

    .status-msg.loading {
      color: var(--color-text-secondary);
    }

    /* â”€â”€ Modal â”€â”€ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.32);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 200ms var(--ease);
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: var(--color-surface-solid);
      border-radius: var(--r-xl);
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 460px;
      margin: var(--sp-4);
      transform: scale(0.96) translateY(8px);
      transition: transform 220ms var(--ease), opacity 220ms var(--ease);
      opacity: 0;
    }

    .modal-overlay.open .modal {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .modal-header {
      padding: var(--sp-5) var(--sp-6) var(--sp-4);
      border-bottom: 1px solid var(--color-border);
    }

    .modal-title {
      font-size: var(--text-md);
      font-weight: 600;
    }

    .modal-subtitle {
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      margin-top: 2px;
    }

    .modal-body {
      padding: var(--sp-5) var(--sp-6);
      display: flex;
      flex-direction: column;
      gap: var(--sp-4);
    }

    .modal-footer {
      padding: var(--sp-4) var(--sp-6) var(--sp-5);
      display: flex;
      gap: var(--sp-3);
      justify-content: flex-end;
      border-top: 1px solid var(--color-border);
    }

    /* â”€â”€ Toast â”€â”€ */
    .toast-stack {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: var(--sp-2);
    }

    .toast {
      background: var(--color-text-primary);
      color: #fff;
      padding: 10px 16px;
      border-radius: var(--r-md);
      font-size: var(--text-sm);
      font-weight: 500;
      box-shadow: var(--shadow-md);
      animation: toast-in 220ms var(--ease) forwards;
    }

    .toast.success {
      background: #1a7a3a;
    }

    .toast.error {
      background: #8a2219;
    }

    @keyframes toast-in {
      from {
        opacity: 0;
        transform: translateY(8px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* â”€â”€ Preview nav â”€â”€ */
    .preview-nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(242, 242, 247, 0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--color-border);
      padding: var(--sp-3) var(--sp-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .preview-brand {
      font-size: var(--text-sm);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--sp-2);
    }

    .preview-brand span {
      color: var(--color-text-tertiary);
      font-weight: 400;
    }

    .tab-group {
      display: flex;
      gap: 2px;
      background: rgba(0, 0, 0, .05);
      border-radius: var(--r-md);
      padding: 2px;
    }

    .tab-btn {
      padding: 6px 16px;
      border: none;
      background: transparent;
      border-radius: 9px;
      font-family: var(--font);
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all var(--duration) var(--ease);
    }

    .tab-btn.active {
      background: white;
      color: var(--color-text-primary);
      box-shadow: 0 1px 3px rgba(0, 0, 0, .10);
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* â”€â”€ Toolbar â”€â”€ */
    .toolbar {
      display: flex;
      gap: var(--sp-3);
      align-items: center;
      flex-wrap: wrap;
    }

    .search-wrap {
      position: relative;
      flex: 1;
      min-width: 160px;
      max-width: 220px;
    }

    .search-wrap svg {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-tertiary);
      pointer-events: none;
    }

    .search-input {
      width: 100%;
      padding: 7px 12px 7px 32px;
      font-family: var(--font);
      font-size: var(--text-sm);
      color: var(--color-text-primary);
      background: var(--color-surface-solid);
      border: 1px solid var(--color-border);
      border-radius: var(--r-md);
      outline: none;
      transition: border-color var(--duration) var(--ease);
    }

    .search-input:focus {
      border-color: var(--color-accent);
    }

    .filter-wrap {
      position: relative;
    }

    .filter-select {
      padding: 7px 28px 7px 10px;
      font-family: var(--font);
      font-size: var(--text-sm);
      color: var(--color-text-secondary);
      background: var(--color-surface-solid);
      border: 1px solid var(--color-border);
      border-radius: var(--r-md);
      outline: none;
      cursor: pointer;
      appearance: none;
    }

    .filter-wrap svg {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-text-tertiary);
      pointer-events: none;
    }

    /* â”€â”€ hint box â”€â”€ */
    .hint-box {
      background: rgba(0, 0, 0, 0.04);
      border-radius: var(--r-md);
      padding: var(--sp-3) var(--sp-4);
      font-size: var(--text-xs);
      color: var(--color-text-secondary);
      line-height: 1.6;
    }

    @media(max-width:720px) {
      .stat-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .grid-2,
      .grid-3 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <!-- â”€â”€ PREVIEW NAV â”€â”€ -->
  <nav class="preview-nav">
    <div class="preview-brand">miMercadito <span>/ preview</span></div>
    <div class="tab-group">
      <button class="tab-btn active" id="tab-dashboard" onclick="switchView('dashboard')">Dashboard</button>
      <button class="tab-btn" id="tab-form" onclick="switchView('form')">+ Producto</button>
    </div>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-dashboard" class="view active">
    <div class="page">

      <!-- Header -->
      <div class="flex items-center justify-between" style="margin-bottom:var(--sp-5);">
        <div>
          <h1 class="text-title">Inventario</h1>
          <p class="text-secondary" style="font-size:var(--text-sm);margin-top:2px;">miMercadito Â· Google Sheets sync
          </p>
        </div>
        <button class="btn btn-primary" onclick="switchView('form')">
          <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <path d="M12 5v14M5 12h14" />
          </svg>
          Nuevo producto
        </button>
      </div>

      <!-- Stat cards (5) -->
      <div class="stat-grid" style="margin-bottom:var(--sp-5);">
        <div class="stat-card">
          <p class="stat-label">En venta</p>
          <p class="stat-value" id="stat-pending">â€”</p>
        </div>
        <div class="stat-card">
          <p class="stat-label">Vendidos</p>
          <p class="stat-value text-accent" id="stat-sold">â€”</p>
        </div>
        <div class="stat-card">
          <p class="stat-label">Stock valorizado</p>
          <p class="stat-value" id="stat-stock">â€”</p>
        </div>
        <div class="stat-card">
          <p class="stat-label">Ingreso ventas</p>
          <p class="stat-value text-success" id="stat-profit">â€”</p>
        </div>
        <div class="stat-card">
          <p class="stat-label">Prom. dÃ­as stock</p>
          <p class="stat-value text-warning" id="stat-avgdays">â€”</p>
        </div>
      </div>

      <!-- Table card -->
      <div class="card" style="padding:0;overflow:hidden;">
        <div class="flex items-center justify-between"
          style="padding:var(--sp-5) var(--sp-5) var(--sp-4);flex-wrap:wrap;gap:var(--sp-3);">
          <p class="text-subtitle">Productos</p>
          <div class="toolbar">
            <div class="search-wrap">
              <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
              </svg>
              <input type="text" class="search-input" placeholder="Buscarâ€¦" oninput="applyFilters()"
                id="search-input" />
            </div>
            <div class="filter-wrap">
              <select class="filter-select" onchange="applyFilters()" id="filter-status">
                <option value="">Todos</option>
                <option value="Pending">En venta</option>
                <option value="Sold">Vendidos</option>
                <option value="Deleted">Archivados</option>
              </select>
              <svg width="10" height="10" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                <path d="m6 9 6 6 6-6" />
              </svg>
            </div>
            <div class="filter-wrap">
              <select class="filter-select" onchange="applyFilters()" id="filter-category">
                <option value="">CategorÃ­a</option>
                <option>Electronics</option>
                <option>Home</option>
                <option>Fashion</option>
                <option>Other</option>
              </select>
              <svg width="10" height="10" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                <path d="m6 9 6 6 6-6" />
              </svg>
            </div>
            <span id="table-count" class="badge badge-neutral">â€” items</span>
          </div>
        </div>
        <div style="border-top:1px solid var(--color-border);overflow-x:auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Producto</th>
                <th>CategorÃ­a</th>
                <th>Costo</th>
                <th>Lista / Piso</th>
                <th>Margen</th>
                <th>DÃ­as</th>
                <th>Estado</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <tr>
                <td colspan="8" style="text-align:center;color:var(--color-text-tertiary);padding:36px;">Cargandoâ€¦</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: FORMULARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="view-form" class="view">
    <div class="page-narrow">
      <div style="margin-bottom:var(--sp-6);">
        <h1 class="text-title">Nuevo producto</h1>
        <p class="text-secondary" style="font-size:var(--text-sm);margin-top:2px;">CompletÃ¡ los datos para agregar al
          inventario.</p>
      </div>
      <div class="card">
        <form id="productForm" class="flex flex-col gap-4">
          <div class="form-group">
            <label class="form-label">Nombre del producto</label>
            <input type="text" name="productName" class="form-control" placeholder="MacBook Pro, iPhone 15â€¦" required />
          </div>
          <div class="grid-2">
            <div class="form-group">
              <label class="form-label">CategorÃ­a</label>
              <select name="category" class="form-select form-control">
                <option>Electronics</option>
                <option>Home</option>
                <option>Fashion</option>
                <option>Other</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Estado (1â€“10)</label>
              <input type="number" name="condition" class="form-control" min="1" max="10" value="10" />
            </div>
          </div>
          <div class="grid-3">
            <div class="form-group">
              <label class="form-label">Costo compra ($)</label>
              <input type="number" name="costPrice" class="form-control" placeholder="Opcional" />
            </div>
            <div class="form-group">
              <label class="form-label">Precio lista ($)</label>
              <input type="number" name="publicPrice" class="form-control" placeholder="0" required />
            </div>
            <div class="form-group">
              <label class="form-label">Precio piso ($)</label>
              <input type="number" name="minPrice" class="form-control" placeholder="0" required />
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Notas</label>
            <input type="text" name="notes" class="form-control" placeholder="Observaciones opcionalesâ€¦" />
          </div>
          <div class="form-group">
            <label class="form-label">Foto</label>
            <input type="file" id="photo" class="form-control" accept="image/*" capture="environment" />
          </div>
          <div style="margin-top:var(--sp-2);">
            <button type="button" id="submitBtn" class="btn btn-primary w-full" onclick="simulateAdd()">
              Guardar producto
            </button>
          </div>
          <div id="status" style="min-height:36px;"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="modal-overlay" onclick="handleOverlayClick(event)">
    <div class="modal" id="modal">
      <div class="modal-header">
        <p class="modal-title" id="modal-title">â€”</p>
        <p class="modal-subtitle" id="modal-subtitle"></p>
      </div>
      <div class="modal-body" id="modal-body"></div>
      <div class="modal-footer" id="modal-footer"></div>
    </div>
  </div>

  <!-- â”€â”€ TOAST â”€â”€ -->
  <div class="toast-stack" id="toast-stack"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let items = [
      { id: '1', name: 'MacBook Pro 14" M3', category: 'Electronics', condition: 9, costPrice: 1400000, listPrice: 1800000, floorPrice: 1600000, notes: 'Impecable', photoUrl: 'https://example.com/photo', status: 'Pending', salePrice: null, saleDate: null, createdAt: '2026-01-10' },
      { id: '2', name: 'iPhone 15 Pro', category: 'Electronics', condition: 8, costPrice: 750000, listPrice: 900000, floorPrice: 820000, notes: '', photoUrl: '', status: 'Pending', salePrice: null, saleDate: null, createdAt: '2026-01-28' },
      { id: '3', name: 'AirPods Pro 2', category: 'Electronics', condition: 10, costPrice: 140000, listPrice: 200000, floorPrice: 180000, notes: 'Sellados', photoUrl: '', status: 'Sold', salePrice: 195000, saleDate: '2026-02-10', createdAt: '2026-02-08' },
      { id: '4', name: 'Silla Herman Miller', category: 'Home', condition: 7, costPrice: 200000, listPrice: 350000, floorPrice: 300000, notes: '', photoUrl: '', status: 'Pending', salePrice: null, saleDate: null, createdAt: '2026-01-05' },
      { id: '5', name: 'PS5 + 2 joysticks', category: 'Electronics', condition: 9, costPrice: 420000, listPrice: 550000, floorPrice: 490000, notes: '', photoUrl: '', status: 'Pending', salePrice: null, saleDate: null, createdAt: '2026-02-15' },
      { id: '6', name: 'Nike Air Max 90', category: 'Fashion', condition: 8, costPrice: 45000, listPrice: 85000, floorPrice: 70000, notes: 'Talle 43', photoUrl: '', status: 'Sold', salePrice: 80000, saleDate: '2026-02-20', createdAt: '2026-02-18' },
      { id: '7', name: 'Aspiradora Dyson V11', category: 'Home', condition: 7, costPrice: 0, listPrice: 180000, floorPrice: 150000, notes: 'Sin costo conocido', photoUrl: '', status: 'Pending', salePrice: null, saleDate: null, createdAt: '2025-11-01' },
    ];
    let _nextId = 7;
    const newId = () => String(_nextId++);

    // â”€â”€ Routing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchView(v) {
      document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      document.getElementById('view-' + v).classList.add('active');
      document.getElementById('tab-' + v).classList.add('active');
      if (v === 'dashboard') renderTable(getFiltered());
    }

    // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateStats() {
      const pending = items.filter(i => i.status === 'Pending');
      const sold = items.filter(i => i.status === 'Sold');
      const stockVal = pending.reduce((s, i) => s + i.listPrice, 0);
      const netProfit = sold.reduce((s, i) => s + (i.salePrice || 0), 0);
      const daysArr = pending.map(i => daysSince(i.createdAt)).filter(d => d >= 0);
      const avgDays = daysArr.length ? Math.round(daysArr.reduce((a, b) => a + b, 0) / daysArr.length) : 0;

      document.getElementById('stat-pending').textContent = pending.length;
      document.getElementById('stat-sold').textContent = sold.length;
      document.getElementById('stat-stock').textContent = '$' + stockVal.toLocaleString('es-AR');
      document.getElementById('stat-profit').textContent = '$' + netProfit.toLocaleString('es-AR');
      document.getElementById('stat-avgdays').textContent = avgDays + 'd';
    }

    // â”€â”€ Filters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getFiltered() {
      const q = (document.getElementById('search-input')?.value || '').toLowerCase();
      const st = document.getElementById('filter-status')?.value || '';
      const cat = document.getElementById('filter-category')?.value || '';
      return items.filter(i => {
        if (!st && i.status === 'Deleted') return false; // hide archived by default
        if (q && !i.name.toLowerCase().includes(q) && !i.notes.toLowerCase().includes(q)) return false;
        if (st && i.status !== st) return false;
        if (cat && i.category !== cat) return false;
        return true;
      });
    }
    function applyFilters() { renderTable(getFiltered()); }

    // â”€â”€ Days helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function daysSince(dateStr) {
      if (!dateStr) return -1;
      const d = new Date(dateStr);
      return isNaN(d) ? -1 : Math.floor((Date.now() - d.getTime()) / 86400000);
    }

    function daysCell(item) {
      const d = daysSince(item.createdAt);
      if (d < 0) return '<span class="text-tertiary">â€”</span>';
      if (item.status === 'Sold') {
        return `<span class="text-tertiary" style="font-size:var(--text-xs);">${d}d</span>`;
      }
      // Color-code urgency: >30d red, >14d orange, ok gray
      const cls = d > 30 ? 'text-danger' : d > 14 ? 'text-warning' : 'text-secondary';
      return `<span class="${cls}" style="font-size:var(--text-xs);font-weight:600;">${d}d</span>`;
    }

    // â”€â”€ Render table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderTable(data) {
      updateStats();
      const tbody = document.getElementById('tableBody');
      document.getElementById('table-count').textContent = data.length + ' items';

      if (!data.length) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;color:var(--color-text-tertiary);padding:36px;">Sin resultados.</td></tr>`;
        return;
      }

      tbody.innerHTML = data.map(item => {
        const isSold = item.status === 'Sold';
        const isDeleted = item.status === 'Deleted';
        const hasCost = item.costPrice > 0;
        const potMargin = hasCost ? item.listPrice - item.costPrice : null;
        const potPct = hasCost && item.listPrice > 0 ? Math.round((potMargin / item.listPrice) * 100) : null;
        const realProfit = isSold && hasCost ? (item.salePrice - item.costPrice) : null;

        const marginCell = isSold
          ? realProfit !== null
            ? `<span class="text-success td-mono" style="font-weight:500;">+$${realProfit.toLocaleString('es-AR')}</span>
               <span class="text-tertiary" style="font-size:var(--text-xs);margin-left:3px;">margen</span>`
            : `<span class="text-tertiary">â€”</span>`
          : potMargin !== null
            ? `<span class="td-mono" style="font-weight:500;">$${potMargin.toLocaleString('es-AR')}</span>
               <span class="text-tertiary" style="font-size:var(--text-xs);margin-left:3px;">${potPct}%</span>`
            : `<span class="text-tertiary">â€”</span>`;

        const statusBadge = isSold
          ? `<span class="badge badge-success">Vendido</span>`
          : isDeleted
            ? `<span class="badge badge-neutral">Archivado</span>`
            : `<span class="badge badge-warning">En venta</span>`;

        const costCell = item.costPrice > 0
          ? `$${item.costPrice.toLocaleString('es-AR')}`
          : `<span class="text-tertiary">â€”</span>`;

        const priceCell = isSold
          ? `<span class="td-mono text-accent" style="font-weight:500;">$${(item.salePrice || 0).toLocaleString('es-AR')}</span>
         <span class="text-tertiary" style="font-size:var(--text-xs);margin-left:3px;">vendido</span>`
          : `<span class="td-mono">$${item.listPrice.toLocaleString('es-AR')}</span>
         <span class="text-tertiary" style="font-size:var(--text-xs);"> / $${item.floorPrice.toLocaleString('es-AR')}</span>`;

        // Action: close sale (only for Pending)
        const sellBtn = (!isSold && !isDeleted) ? `
      <button class="action-btn sell" onclick="openSellModal('${item.id}')" title="Cerrar venta">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>
      </button>` : `<span style="width:30px;display:inline-block;"></span>`;

        // Action: WhatsApp share (only for Pending)
        const waBtn = (!isSold && !isDeleted) ? `
      <button class="action-btn wa" onclick="shareWhatsApp('${item.id}')" title="Compartir por WhatsApp">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.126.558 4.121 1.529 5.847L0 24l6.338-1.502A11.93 11.93 0 0 0 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.818a9.779 9.779 0 0 1-5.003-1.373l-.36-.214-3.727.883.935-3.625-.235-.374A9.778 9.778 0 0 1 2.182 12C2.182 6.57 6.57 2.182 12 2.182S21.818 6.57 21.818 12 17.43 21.818 12 21.818z"/></svg>
      </button>` : `<span style="width:30px;display:inline-block;"></span>`;

        // Archive / restore icon
        const archiveBtn = isDeleted ? `
      <button class="action-btn" onclick="restoreItem('${item.id}')" title="Restaurar" style="color:var(--color-accent);">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-3"/></svg>
      </button>` : `
      <button class="action-btn delete" onclick="openArchiveModal('${item.id}')" title="Archivar">
        <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
      </button>`;

        return `<tr class="${isSold || isDeleted ? 'row-faded' : ''}">
      <td class="td-name">${escHtml(item.name)}${item.notes
            ? `<br><span class="text-tertiary" style="font-size:var(--text-xs);font-weight:400;">${escHtml(item.notes)}</span>`
            : ''}
      </td>
      <td><span class="badge badge-neutral">${item.category}</span></td>
      <td class="td-mono text-secondary">${costCell}</td>
      <td>${priceCell}</td>
      <td>${marginCell}</td>
      <td>${daysCell(item)}</td>
      <td>${statusBadge}</td>
      <td>
        <div class="row-actions">
          <button class="action-btn" onclick="openEditModal('${item.id}')" title="Editar">
            <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4Z"/></svg>
          </button>
          ${waBtn}
          ${sellBtn}
          ${archiveBtn}
        </div>
      </td>
    </tr>`;
      }).join('');
    }

    // â”€â”€ Modal helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openModal() { document.getElementById('modal-overlay').classList.add('open'); }
    function closeModal() { document.getElementById('modal-overlay').classList.remove('open'); }
    function handleOverlayClick(e) { if (e.target.id === 'modal-overlay') closeModal(); }

    function setModal({ title, subtitle = '', body, footer }) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-subtitle').textContent = subtitle;
      document.getElementById('modal-body').innerHTML = body;
      document.getElementById('modal-footer').innerHTML = footer;
      openModal();
    }

    // â”€â”€ Modal: Sell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openSellModal(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      setModal({
        title: 'Cerrar venta',
        subtitle: item.name,
        body: `
      <div class="form-group">
        <label class="form-label">Precio de venta ($)</label>
        <input type="number" id="modal-sale-price" class="form-control" value="${item.listPrice}" />
        <span style="font-size:var(--text-xs);color:var(--color-text-tertiary);">
          Piso: $${item.floorPrice.toLocaleString('es-AR')} Â· Lista: $${item.listPrice.toLocaleString('es-AR')}
        </span>
      </div>`,
        footer: `
      <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmSell('${id}')">Confirmar venta</button>`
      });
      setTimeout(() => document.getElementById('modal-sale-price')?.focus(), 80);
    }

    function confirmSell(id) {
      const price = parseFloat(document.getElementById('modal-sale-price').value);
      if (!price || price <= 0) { toast('IngresÃ¡ un precio vÃ¡lido', 'error'); return; }
      const item = items.find(i => i.id === id);
      if (!item) return;
      item.status = 'Sold';
      item.salePrice = price;
      item.saleDate = new Date().toISOString().split('T')[0];
      closeModal();
      renderTable(getFiltered());
      const profit = price - item.costPrice;
      toast(`âœ… ${item.name} Â· Ganancia $${profit.toLocaleString('es-AR')}`, 'success');
    }

    // â”€â”€ Modal: Edit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openEditModal(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      const cats = ['Electronics', 'Home', 'Fashion', 'Other'];
      setModal({
        title: 'Editar producto',
        subtitle: item.name,
        body: `
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input type="text" id="e-name" class="form-control" value="${escAttr(item.name)}" />
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--sp-3);">
        <div class="form-group">
          <label class="form-label">CategorÃ­a</label>
          <select id="e-cat" class="form-select form-control">
            ${cats.map(c => `<option${c === item.category ? ' selected' : ''}>${c}</option>`).join('')}
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Estado (1â€“10)</label>
          <input type="number" id="e-cond" class="form-control" min="1" max="10" value="${item.condition}" />
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:var(--sp-3);">
        <div class="form-group">
          <label class="form-label">Costo ($)</label>
          <input type="number" id="e-cost" class="form-control" value="${item.costPrice}" />
        </div>
        <div class="form-group">
          <label class="form-label">Lista ($)</label>
          <input type="number" id="e-list" class="form-control" value="${item.listPrice}" />
        </div>
        <div class="form-group">
          <label class="form-label">Piso ($)</label>
          <input type="number" id="e-floor" class="form-control" value="${item.floorPrice}" />
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Notas</label>
        <input type="text" id="e-notes" class="form-control" value="${escAttr(item.notes)}" placeholder="Opcionalâ€¦" />
      </div>`,
        footer: `
      <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmEdit('${id}')">Guardar cambios</button>`
      });
    }

    function confirmEdit(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      item.name = document.getElementById('e-name').value.trim() || item.name;
      item.category = document.getElementById('e-cat').value;
      item.condition = parseInt(document.getElementById('e-cond').value) || item.condition;
      item.costPrice = parseFloat(document.getElementById('e-cost').value) || item.costPrice;
      item.listPrice = parseFloat(document.getElementById('e-list').value) || item.listPrice;
      item.floorPrice = parseFloat(document.getElementById('e-floor').value) || item.floorPrice;
      item.notes = document.getElementById('e-notes').value.trim();
      closeModal();
      renderTable(getFiltered());
      toast('Producto actualizado', 'success');
    }

    // â”€â”€ Archive / Restore (soft delete) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openArchiveModal(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      setModal({
        title: 'Archivar producto',
        subtitle: item.name,
        body: `
      <p style="font-size:var(--text-sm);color:var(--color-text-secondary);line-height:1.7;">
        El producto se marcarÃ¡ como <strong>Archivado</strong> y desaparecerÃ¡ del inventario activo.
      </p>
      <div class="hint-box">
        ğŸ’¡ No se borra del spreadsheet â€” podÃ©s restaurarlo filtrando por <em>Archivados</em> o tocando el Ã­cono â†º.
      </div>`,
        footer: `
      <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-danger" onclick="confirmArchive('${id}')">Archivar</button>`
      });
    }

    function confirmArchive(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      item.status = 'Deleted';
      closeModal();
      renderTable(getFiltered());
      toast(`${item.name} archivado`, 'error');
    }

    function restoreItem(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;
      item.status = 'Pending';
      renderTable(getFiltered());
      toast(`${item.name} restaurado al inventario`, 'success');
    }

    // â”€â”€ WhatsApp share â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function shareWhatsApp(id) {
      const item = items.find(i => i.id === id);
      if (!item) return;

      const cond = item.condition ? `Estado ${item.condition}/10` : '';
      const notes = item.notes ? `\nğŸ“ ${item.notes}` : '';
      const msg = `ğŸ›’ *${item.name}*\n${cond}\nğŸ’° $${item.listPrice.toLocaleString('es-AR')}${notes}\n\n_Â¿Te interesa?_`;

      // Convertir URL de Drive a URL directa de imagen para fetch y preview
      // e.g. https://drive.google.com/file/d/FILE_ID/view â†’ https://drive.google.com/uc?export=view&id=FILE_ID
      function toDriveDirectUrl(url) {
        if (!url) return null;
        const m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (m) return `https://drive.google.com/uc?export=view&id=${m[1]}`;
        if (url.includes('id=')) return url.replace('open?', 'uc?export=view&');
        return url.includes('http') ? url : null;
      }

      const imageUrl = toDriveDirectUrl(item.photoUrl);

      // â”€â”€ Intento 1: Web Share API con archivo adjunto (solo mÃ³vil con foto) â”€â”€
      if (imageUrl && navigator.canShare && navigator.share) {
        try {
          toast('Cargando fotoâ€¦');
          const res = await fetch(imageUrl, { mode: 'cors' });
          if (!res.ok) throw new Error('fetch failed');
          const blob = await res.blob();
          const ext = blob.type.includes('png') ? 'png' : 'jpg';
          const file = new File([blob], `${item.name}.${ext}`, { type: blob.type });

          if (navigator.canShare({ files: [file] })) {
            await navigator.share({ files: [file], title: item.name, text: msg });
            return;
          }
        } catch (e) {
          // Fall through to text share
        }
      }

      // â”€â”€ Intento 2: Web Share API solo texto (sin archivo) â”€â”€
      if (navigator.share) {
        try {
          const shareData = { title: item.name, text: msg };
          if (imageUrl) shareData.url = imageUrl;
          await navigator.share(shareData);
          return;
        } catch (e) { /* cancelled or not supported */ }
      }

      // â”€â”€ Fallback: wa.me link con texto + link a foto â”€â”€
      const photoLine = imageUrl ? `\nğŸ“¸ ${imageUrl}` : '';
      const fullMsg = msg.replace('_Â¿Te interesa?_', '') + photoLine + '\n\n_Â¿Te interesa?_';
      window.open(`https://wa.me/?text=${encodeURIComponent(fullMsg)}`, '_blank');
    }

    // â”€â”€ Form: Add â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function simulateAdd() {
      const btn = document.getElementById('submitBtn');
      const status = document.getElementById('status');
      const form = document.getElementById('productForm');
      if (!form.checkValidity()) {
        status.innerHTML = `<div class="status-msg error">CompletÃ¡ los campos obligatorios.</div>`;
        return;
      }
      btn.disabled = true;
      status.innerHTML = `<div class="status-msg loading">Guardandoâ€¦</div>`;
      setTimeout(() => {
        items.unshift({
          id: newId(),
          name: form.productName.value.trim(),
          category: form.category.value,
          condition: parseInt(form.condition.value) || 10,
          costPrice: parseFloat(form.costPrice.value) || 0,
          listPrice: parseFloat(form.publicPrice.value) || 0,
          floorPrice: parseFloat(form.minPrice.value) || 0,
          notes: form.notes.value.trim(),
          photoUrl: '',
          status: 'Pending',
          salePrice: null,
          saleDate: null,
          createdAt: new Date().toISOString().split('T')[0],
        });
        status.innerHTML = `<div class="status-msg success">âœ… Producto guardado.</div>`;
        btn.disabled = false;
        form.reset();
        setTimeout(() => { status.innerHTML = ''; switchView('dashboard'); }, 1000);
      }, 800);
    }

    // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toast(msg, type = '') {
      const el = document.createElement('div');
      el.className = 'toast ' + type;
      el.textContent = msg;
      document.getElementById('toast-stack').appendChild(el);
      setTimeout(() => el.remove(), 3200);
    }

    // â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function escHtml(s = '') {
      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    function escAttr(s = '') { return escHtml(s); }

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => renderTable(items), 350);
    });
  </script>
</body>

</html>